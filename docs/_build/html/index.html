

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>django-common &mdash; django-common v0.1.34 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.34',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-common v0.1.34 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">django-common v0.1.34 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="django-common">
<h1>django-common<a class="headerlink" href="#django-common" title="Permalink to this headline">¶</a></h1>
<p>The django-common package contains things which speed up
the development with django.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Install <tt class="docutils literal"><span class="pre">django-common</span></tt> package with <tt class="docutils literal"><span class="pre">pip</span></tt> or <tt class="docutils literal"><span class="pre">easy_install</span></tt></li>
<li>Append <tt class="docutils literal"><span class="pre">common</span></tt> to the <tt class="docutils literal"><span class="pre">settings.INSTALLED_APPS</span></tt></li>
</ul>
</div>
<div class="section" id="module-common.decorators">
<span id="decorators"></span><h2>Decorators<a class="headerlink" href="#module-common.decorators" title="Permalink to this headline">¶</a></h2>
<p>Contains view&#8217;s decorators which automates common tasks.</p>
<dl class="function">
<dt id="common.decorators.render_to">
<tt class="descclassname">common.decorators.</tt><tt class="descname">render_to</tt><big>(</big><em>template</em><big>)</big><a class="headerlink" href="#common.decorators.render_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Render view&#8217;s output with <tt class="docutils literal"><span class="pre">template</span></tt> using <tt class="docutils literal"><span class="pre">RequestContext</span></tt>.</p>
<p>If decorated view returns dict object then wrap it in RequestContext and
render the template.</p>
<p>If decorated view returns non dict object then just return this object.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">template:</th><td class="field-body">path to template</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@render_to</span><span class="p">(</span><span class="s">&#39;blog/index.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="common.decorators.ajax">
<tt class="descclassname">common.decorators.</tt><tt class="descname">ajax</tt><big>(</big><em>func</em><big>)</big><a class="headerlink" href="#common.decorators.ajax" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert views&#8217;s output into JSON.</p>
<p>Decorated view should return dict object.</p>
<p>If <tt class="docutils literal"><span class="pre">request.method</span></tt> is not <tt class="docutils literal"><span class="pre">POST</span></tt> then deny the request.</p>
<p>If view raises Exception then return JSON message with error description.</p>
</dd></dl>

</div>
<div class="section" id="module-common.pagination">
<span id="pagination"></span><h2>Pagination<a class="headerlink" href="#module-common.pagination" title="Permalink to this headline">¶</a></h2>
<p>Django-common pagination module dramatically simplifies the pagination task.</p>
<p>You only have to do following things.</p>
<p>In view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@render_to</span><span class="p">(</span><span class="s">&#39;foo_list.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">paginate</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>In template:</p>
<div class="highlight-python"><pre>&lt;ul&gt;
{% for item in page.object_list %}
    &lt;li&gt;{{ item }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;

{% include "pagination.html" %}</pre>
</div>
<p>If you want to know how this work under the hood please look at source code.</p>
<dl class="function">
<dt id="common.pagination.paginate">
<tt class="descclassname">common.pagination.</tt><tt class="descname">paginate</tt><big>(</big><em>qs</em>, <em>request</em>, <em>per_page=15</em>, <em>frame_size=10</em><big>)</big><a class="headerlink" href="#common.pagination.paginate" title="Permalink to this definition">¶</a></dt>
<dd><p>Return extended <tt class="docutils literal"><span class="pre">django.core.paginator.Page</span></tt> object</p>
<p>Args:</p>
<blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">qs:</th><td class="field-body">queryset which should be paginated</td>
</tr>
<tr class="field"><th class="field-name">request:</th><td class="field-body">django request object</td>
</tr>
<tr class="field"><th class="field-name">per_page:</th><td class="field-body">number of objects per page</td>
</tr>
<tr class="field"><th class="field-name">frame_size:</th><td class="field-body">number of visible pages (does not include first and large page)</td>
</tr>
</tbody>
</table>
</blockquote>
</dd></dl>

</div>
<div class="section" id="module-common.forms">
<span id="forms"></span><h2>Forms<a class="headerlink" href="#module-common.forms" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="common.forms.build_form">
<tt class="descclassname">common.forms.</tt><tt class="descname">build_form</tt><big>(</big><em>Form</em>, <em>_request</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#common.forms.build_form" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the <tt class="docutils literal"><span class="pre">Form</span></tt> instance.</p>
<p>If <tt class="docutils literal"><span class="pre">request.method</span></tt> is <tt class="docutils literal"><span class="pre">POST</span></tt> then build bound form else build unbound.</p>
<p>Usage example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_required</span>
<span class="nd">@render_to</span><span class="p">(</span><span class="s">&#39;blog/post_create.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">build_form</span><span class="p">(</span><span class="n">PostForm</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="common.forms.DeleteForm">
<em class="property">class </em><tt class="descclassname">common.forms.</tt><tt class="descname">DeleteForm</tt><a class="headerlink" href="#common.forms.DeleteForm" title="Permalink to this definition">¶</a></dt>
<dd><p>This form could be used in conjunction with <tt class="docutils literal"><span class="pre">build_form</span></tt> on pages where user have to confirm some action.</p>
<p>Typical example of such page is deletion the some object.</p>
<dl class="docutils">
<dt>Fields:</dt>
<dd><table class="first last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">next:</th><td class="field-body">this is optional field. You can use it to store redirection URL.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>Usage example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@render_to</span><span class="p">(</span><span class="s">&#39;blog/post_delete.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_delete</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">postid</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">postid</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">build_form</span><span class="p">(</span><span class="n">DeleteForm</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;next&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">)})</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">post</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">,</span>
           <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-common.fields">
<span id="model-fields"></span><h2>Model Fields<a class="headerlink" href="#module-common.fields" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="common.fields.AutoOneToOneField">
<em class="property">class </em><tt class="descclassname">common.fields.</tt><tt class="descname">AutoOneToOneField</tt><a class="headerlink" href="#common.fields.AutoOneToOneField" title="Permalink to this definition">¶</a></dt>
<dd><p>OneToOneField creates dependent object on first request from parent object
if dependent oject has not created yet.</p>
<p>More info (in russian): <a class="reference external" href="http://softwaremaniacs.org/blog/2007/03/07/auto-one-to-one-field/">http://softwaremaniacs.org/blog/2007/03/07/auto-one-to-one-field/</a></p>
<p>Usage example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in models.py</span>
<span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">AutoOneToOneField</span><span class="p">(</span><span class="s">&#39;auth.User&#39;</span><span class="p">)</span>
    <span class="n">icq</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

<span class="c"># in some view</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;batman&#39;</span><span class="p">,</span> <span class="s">&#39;batman@gmail.com&#39;</span><span class="p">,</span> <span class="s">&#39;Robin&#39;</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">icq</span> <span class="o">=</span> <span class="s">&#39;827873948&#39;</span>
<span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="common.fields.JSONField">
<em class="property">class </em><tt class="descclassname">common.fields.</tt><tt class="descname">JSONField</tt><a class="headerlink" href="#common.fields.JSONField" title="Permalink to this definition">¶</a></dt>
<dd><p>JSONField allows to store any data which is serialized in JSON under the hood.</p>
<p>Usage example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># in models.py</span>
<span class="k">class</span> <span class="nc">Video</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">thumbnails</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">()</span>

<span class="c"># in some view</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">Video</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">thumbnails</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;2.jpg&#39;</span><span class="p">]</span>
<span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-common.enum">
<span id="enum"></span><h2>Enum<a class="headerlink" href="#module-common.enum" title="Permalink to this headline">¶</a></h2>
<p>This module provides <tt class="docutils literal"><span class="pre">Enum</span></tt> class which simplifies work with enumerated list of choices.
This implementation is specially developed for use in django models.</p>
<p>Example of usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">common</span> <span class="kn">import</span> <span class="n">enum</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">red</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;So greeeen&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We defined here two items. They are accessable as <tt class="docutils literal"><span class="pre">Color.red</span></tt> and <tt class="docutils literal"><span class="pre">Color.green</span></tt>.
<tt class="docutils literal"><span class="pre">Color.red</span></tt> will give you <tt class="docutils literal"><span class="pre">1</span></tt>. So <tt class="docutils literal"><span class="pre">Color.red</span> <span class="pre">==</span> <span class="pre">1</span></tt> is <tt class="xref docutils literal"><span class="pre">True</span></tt>.</p>
<p>First item (<tt class="docutils literal"><span class="pre">Color.red</span></tt>) has the label same to its key i.e., &#8220;red&#8221;. Second item (<tt class="docutils literal"><span class="pre">Color.green</span></tt>) has the custom label.  Labels are used when Color object are queried for the (key, label) pairs. This happens, for example, when we use Color object as the value for the <tt class="docutils literal"><span class="pre">choices</span></tt> argument of django field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Fruit</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">Color</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Color</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
</pre></div>
</div>
<p>We can use Color object as <tt class="docutils literal"><span class="pre">choices</span></tt> argument because <tt class="docutils literal"><span class="pre">enum.Enum</span></tt> class provides custom __iter__
method which returs (key, label) pairs.</p>
<p>Also keep in mind that <tt class="docutils literal"><span class="pre">Color.red</span></tt> is not simple integer. It is like integer but has
some extra methods. Look example:</p>
<blockquote>
Color.green == 2
Color.green.label == &#8220;So greeeen&#8221;
Color.green.key == &#8220;green&#8221;</blockquote>
<p>Other useful methods of enum.Enum class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Color</span><span class="o">.</span><span class="n">by_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">red</span>
<span class="n">Color</span><span class="o">.</span><span class="n">by_key</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">red</span>
<span class="n">Color</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">Color</span><span class="o">.</span><span class="n">red</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">green</span><span class="p">]</span>
<span class="n">Color</span><span class="o">.</span><span class="n">random_value</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Random value choosed from Color items&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">django-common</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#module-common.decorators">Decorators</a></li>
<li><a class="reference internal" href="#module-common.pagination">Pagination</a></li>
<li><a class="reference internal" href="#module-common.forms">Forms</a></li>
<li><a class="reference internal" href="#module-common.fields">Model Fields</a></li>
<li><a class="reference internal" href="#module-common.enum">Enum</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">django-common v0.1.34 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Grigoriy Petukhov.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.3.
    </div>
  </body>
</html>